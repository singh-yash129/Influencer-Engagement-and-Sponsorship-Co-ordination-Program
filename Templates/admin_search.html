<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='find.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        
        /* General Styles */
        body {
            background: #f4f7fc;
            color: #333;
            margin: 10px;
            padding: 0;
            line-height: 1.6;
        }

        .tab-container {
            margin: 30px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: #f1f1f1;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            background: #f1f1f1;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .tab:hover,
        .tab.active {
            background: #6a11cb;
            color: #fff;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        .content-table {
            display: table;
            width: 100%;
            border-spacing: 0;
            margin-bottom: 20px;
        }

        .content-table-header {
            display: table-header-group;
            background: #f9f9f9;
            font-weight: bold;
            padding: 10px 0;
        }

        .content-table-row {
            display: table-row;
        }

        .content-table-cell {
            display: table-cell;
            padding: 10px;
            vertical-align: middle;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }

        .content-table-cell img {
            height: 60px;
            width: 60px;
            border-radius: 50%;
            margin-right: 15px;
        }

        .header-content {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .header-content img {
            height: 30px;
            width: 30px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .header-content h4, .header-content h3 {
            margin: 0;
            font-size: 16px;
        }

        #buttons button {
            padding: 10px 20px;
            margin: 5px;
            background: #6a11cb;
            color: #fff;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .print-export-buttons button{
            padding: 10px 20px;
            margin: 5px;
            background: #6a11cb;
            color: #fff;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: background 0.3s ease;

        }
        #buttons button:hover {
            background: #2575fc;
        }
        .print-export-buttons button:hover{
            background: #2575fc;

        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        
        .material-symbols-outlined {
            vertical-align: middle; 
            margin-right: 8px; 
        }
        
        
        #results {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px;
            background-color: aliceblue;
            border: 1px solid rgb(42, 211, 161);
            border-radius: 10px;
            padding: 20px;
            

        }
      .campaign-box {
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .campaign-box img {
            width: 100%;
            height: 150px;
            border-radius: 10px;
            object-fit: cover;
        }

        .campaign-box h4 {
            margin: 15px 0 10px;
            font-size: 18px;
        }

        .campaign-box p {
            margin-bottom: 10px;
            color: #555;
        }

        .campaign-box button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .campaign-box button .material-symbols-outlined {
            margin-right: 5px;
        }

        .campaign-box button:hover {
            background-color: #218838;
        }
.flagged-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.flagged-table th, .flagged-table td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.flagged-table th {
    background: #6a11cb; 
    color: #fff; 
    font-weight: bold; 
    text-transform: uppercase; 

.flagged-table td {
    color: #333;
}

.flagged-table tr:hover {
    background-color: #f4f4f4; 

.flagged-table img {
    height: 60px;
    width: 60px; 
    border-radius: 50%; 
}

.unflag-button {
    padding: 10px 20px;
    background: #f44336; 
    color: #fff;  
    border: none; 
    border-radius: 30px; 
    cursor: pointer; 
    transition: background 0.3s ease; 
    font-size: 14px;
    text-align: center; 
}

.unflag-button:hover {
    background: #d32f2f;
}

@media (max-width: 768px) {
    .flagged-table th, .flagged-table td {
        padding: 10px;
        font-size: 14px; 
    }

    .unflag-button {
        padding: 8px 16px;
        font-size: 12px;
    }
}
#friends {
    margin: 20px auto;
    padding: 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    border: 1px solid #ccc;
    border-radius: 15px;
    background: linear-gradient(to right, #e0e0e0, #f7f7f7);
    transition: background 0.3s ease, transform 0.3s ease;
    max-width: 90%;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

#friends:hover {
    transform: scale(1.02);
    background: linear-gradient(to right, #007bff, #66b3ff);
}

#f1, #f3, #f4 {
    display: flex;
    align-items: center;
    gap: 20px;
}

#f1 {
    flex: 1;
}

#f1 img {
    border: 2px solid #ddd;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    transition: border 0.3s ease;
}

#f1 img:hover {
    border-color: #66b3ff;
}

#f1 h4 {
    margin: 0;
    font-size: 20px;
    color: #333;
}

#f3 {
    flex: 2;
    font-size: 16px;
}

#f4 h4 {
    margin: 0;
    font-size: 18px;
    color: #333;
}

#f4 h5 {
    margin: 0;
    font-size: 14px;
    color: #f39c12;
}

#f2 {
    display: flex;
    align-items: center;
    gap: 15px;
}

#f2 .material-symbols-outlined {
    background-color: #f9f9f9;
    padding: 8px;
    border-radius: 50%;
    border: 1px solid #ddd;
    font-size: 24px;
    color: #333;
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

#f2 .material-symbols-outlined:hover {
    background-color: #e0e0e0;
    color: #007bff;
    border-color: #007bff;
}


    </style>
</head>

<body>
    <div class="header">
        <div id="logo">
            <img src="{{ url_for('static', filename='logo.jpeg') }}" alt="IEAS Logo">
        </div>
        <div id="links">
            <a href="{{ url_for('admin_dashboard') }}">Dashboard</a>
            <a href="{{url_for('admin_list')}}">Info</a>
            <a href="{{url_for('admin_payment')}}">Payments</a>
            <a href="{{ url_for('about') }}">Stats</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </div>
    <div class="tab-container">
        <div class="tabs">
            <div class="tab" onclick="showTab('user')">Users Search</div>
            <div class="tab" onclick="showTab('campaign')">Campaign Search</div>
            <div class="tab" onclick="showTab('flagged')">Flagged Data</div>
 
        </div>
        <div class="tab-content active" id="flagged">
            <h3 style="text-align: center;">Flagged Items</h3>
            <table class="flagged-table">
                <thead>
                    <tr>
                        <th>User ID</th>
                        <th>Campaign ID</th>
                        <th>Flag Reason</th>
                        <th>Role</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for flag in flagged_items %}
                    <tr id="flagged-item-{{ flag.user_id }}">
                        <td>{{ flag.user_id }}</td>
                        <td>{{ flag.campaign_id }}</td>
                        <td>{{ flag.flag }}</td>
                        <td>{{ flag.role }}</td>
                        <td>
                            <button class="unflag-button" onclick="handleAction('{{ flag.user_id }}','{{ flag.campaign_id }}','unflagged','{{ flag.role }}')">Unflag</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="tab-content" id="user">
            <h3 style="text-align: center;">Influencer and Sponsor Search Section :</h3>

            <div id="bar">
                <div class="search">
                    <span class="material-symbols-outlined">search</span>
                    <input type="search" id="search-input" placeholder="Search .." onkeyup="performSearch()">
                </div>
    
                <div id="filter">
                    <button id="filter-button" onclick="toggleFilterOptions()">Filter <span class="material-symbols-outlined">filter_alt</span></button>
                    <div id="filter-options" style="display: none;">
                        <label><input type="checkbox" name="filter" value="influencer" onchange="performSearch()"> Influencer</label>
                        <label><input type="checkbox" name="filter" value="sponsor" onchange="performSearch()"> Sponsor</label>
                    </div>
                </div>
                <div id="sort">
                    <button id="sort-button" onclick="toggleSortOptions()">Sort <span class="material-symbols-outlined">sort</span></button>
                    <div id="sort-options" style="display: none;">
                        <button data-sort="asc" onclick="sortByName('asc')">Sort by Name <span class="material-symbols-outlined">sort_by_alpha</span> (Asc)</button>
                        <button data-sort="desc" onclick="sortByName('desc')">Sort by Name <span class="material-symbols-outlined">sort_by_alpha</span> (Desc)</button>
                    </div>
                </div>
            </div>
            <div id="search-results"></div>
        </div>

        <div class="tab-content" id="campaign">
            <h3 style="text-align: center;">Campaign Search Section :</h3>

            <div id="bar">
                <div class="search">
                    <span class="material-symbols-outlined">search</span>
                    <input type="search" id="searchInput" placeholder="Search Campaigns" onkeyup="searchCampaigns()">
                </div>
                <div id="filter">
                    <button id="filter-button" onclick="toggleFilterOptionsk()">Filter <span class="material-symbols-outlined">filter_alt</span></button>
                    <div id="filter-options1" style="display:none;">
                        <label><input type="checkbox" value="Technology" onchange="searchCampaigns()"> Technology</label>
                        <label><input type="checkbox" value="Fashion" onchange="searchCampaigns()"> Fashion</label>
                        <label><input type="checkbox" value="Food" onchange="searchCampaigns()"> Food</label>
                    </div>
                </div>
                <div id="sort">
                    <button id="sort-button" onclick="toggleSortOptionsk()">Sort <span class="material-symbols-outlined">sort</span></button>
                    <div id="sort-options1" style="display:none;">
                        <button onclick="sortBy('start_asc')" data-sort="start_asc">Start Date <span class="material-symbols-outlined">arrow_upward</span></button>
                        <button onclick="sortBy('start_desc')" data-sort="start_desc">Start Date <span class="material-symbols-outlined">arrow_downward</span></button>
                        <button onclick="sortBy('budget_asc')" data-sort="budget_asc">Budget <span class="material-symbols-outlined">arrow_upward</span></button>
                        <button onclick="sortBy('budget_desc')" data-sort="budget_desc">Budget <span class="material-symbols-outlined">arrow_downward</span></button>
                    </div>
                    
                </div>
            </div>
    
            <div id="results"></div>
        </div>




    <script>
 function toggleFilterOptionsk() {
            var filterOptions = document.getElementById('filter-options1');
            filterOptions.style.display = filterOptions.style.display === 'block' ? 'none' : 'block';
        }

        function toggleSortOptionsk() {
            var sortOptions = document.getElementById('sort-options1');
            sortOptions.style.display = sortOptions.style.display === 'block' ? 'none' : 'block';
        }

        function searchCampaigns() {
            const searchTerm = document.getElementById('searchInput').value;
            const filters = Array.from(document.querySelectorAll('#filter-options1 input:checked')).map(el => el.value);
            const sortOrder = document.querySelector('#sort-options1 button.active')?.getAttribute('data-sort') || '';

            const params = new URLSearchParams({ search: searchTerm, niche: filters.join(','), sort: sortOrder });

            fetch('/admin_campaigns?' + params.toString())
    .then(response => response.json())
    .then(campaigns => {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = campaigns.map(campaign => {
            const userUrl = `{{ url_for('camp_view', campaign_id='') }}${campaign.campaign_id}`;
            return `
                <div class="campaign-box">
                    <img src="/uploads/${campaign.image}" alt="Campaign Image" onclick="window.location.href='${userUrl}'">
                    <h4>${campaign.title}</h4>
                    <p>Budget: $${campaign.budget}</p>
                    <button onclick="handleAction('${campaign.user_id}','${campaign.campaign_id}','flagged','sponsor')">
                        <span class="material-symbols-outlined">flag</span>Flag
                    </button>
                </div>
            `;
        }).join('');
    });
        }

        function sortBy(order) {
            document.querySelectorAll('#sort-options1 button').forEach(button => {
                button.classList.remove('active');
            });
            const sortButton = document.querySelector(`#sort-options1 button[data-sort='${order}']`);
    sortButton.classList.add('active');


    // Set the data-sort attribute correctly
    sortButton.setAttribute('data-sort', order);

    // Trigger search with updated sorting
    searchCampaigns();
        }        const currentUser = "{{ current_user.username }}"; // Replace with the actual logged-in user username

function toggleFilterOptions() {
    const filterOptions = document.getElementById('filter-options');
    const sortOptions = document.getElementById('sort-options');
    filterOptions.style.display = filterOptions.style.display === 'none' ? 'block' : 'none';
    sortOptions.style.display = 'none';
}

function toggleSortOptions() {
    const sortOptions = document.getElementById('sort-options');
    const filterOptions = document.getElementById('filter-options');
    sortOptions.style.display = sortOptions.style.display === 'none' ? 'block' : 'none';
    filterOptions.style.display = 'none';
}

function performSearch() {
    const query = document.getElementById('search-input').value;
    const filterOptions = document.querySelectorAll('#filter-options input[name="filter"]:checked');
    const sortOption = document.querySelector('#sort-options button.active');

    const filters = Array.from(filterOptions).map(option => option.value);
    const sort = sortOption ? sortOption.getAttribute('data-sort') : 'asc';

    if (query.length > 2) {
        fetch(`/search_admin?query=${encodeURIComponent(query)}&filters=${encodeURIComponent(JSON.stringify(filters))}&sort=${sort}`)
            .then(response => response.json())
            .then(data => {
                const resultsDiv = document.getElementById('search-results');
                resultsDiv.innerHTML = '';
                data.forEach(user => {
                    const userUrl = `{{ url_for('view_person', users='') }}${user.username}`;
                    resultsDiv.innerHTML += `
                        <div id="friends" >
                            <div id="f1" onclick="window.location.href='${userUrl}'">
                                <img src="${user.profile_image}" alt="" width="50px" height="50px">
                                <h4>${user.username}</h4>
                            </div>    
                                <div id="f3">
                                    <div id="f4">
                                    
                                        <h4>${user.first_name} ${user.last_name}</h4>
                                        <h5>Role :${user.role}</h5>
                                        <h5>Industry :${user.industry}</h5>

                                    </div>
                                </div>
                            
                            <div id="f2" style='cursor:pointer'>
                                <span class="material-symbols-outlined" onclick="handleAction('${user.username}','$','flagged','influencer')">flag</span>
                            
                            </div>
                        </div>
                    `;
                });
            });
    }
}

function sortByName(order) {
    document.querySelectorAll('#sort-options button').forEach(button => {
        button.classList.remove('active');
    });
    const sortButton = document.querySelector(`#sort-options button[data-sort='${order}']`);
    sortButton.classList.add('active');

    // Trigger search with updated sorting
    performSearch();
}

document.addEventListener('click', function(event) {
    const filterOptions = document.getElementById('filter-options');
    const sortOptions = document.getElementById('sort-options');
    const filterButton = document.getElementById('filter-button');
    const sortButton = document.getElementById('sort-button');

    if (!filterOptions.contains(event.target) && !filterButton.contains(event.target)) {
        filterOptions.style.display = 'none';
    }

    if (!sortOptions.contains(event.target) && !sortButton.contains(event.target)) {
        sortOptions.style.display = 'none';
    }
});
        function showTab(tabId) {
            // Hide all tab contents
            var contents = document.querySelectorAll('.tab-content');
            contents.forEach(function (content) {
                content.classList.remove('active');
            });

            // Remove active class from all tabs
            var tabs = document.querySelectorAll('.tab');
            tabs.forEach(function (tab) {
                tab.classList.remove('active');
            });

            // Show the selected tab content
            document.getElementById(tabId).classList.add('active');

            // Add active class to the selected tab
            var activeTab = document.querySelector('.tab[onclick="showTab(\'' + tabId + '\')"]');
            if (activeTab) {
                activeTab.classList.add('active');
            }
        }

        function handleAction(userId,campaignId, action,role) {
            fetch(`/admin/${userId}/${campaignId}/${action}/${role}`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                window.location.reload(); // Reload to reflect changes
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>
</body>

</html>
